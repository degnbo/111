<include file="Public/header"/>
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>数据表格</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="{:U('Index/index')}">内容列表</a>
                        </li>
                        <li>
                            <strong>内容列表</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">

                </div>
            </div>
        <script>
            function fnClickAddRow() {
                var url="{:U('Article/lis')}";
                location.href=url;
            }
        </script>

            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <span class="">
                                    <a onclick="fnClickAddRow();" href="javascript:void(0);" class="btn btn-primary ">发布内容</a>
                                </span>
                                <form action="{:U('Article/all',array('cid'=>I('get.cid')))}" method="get">
                                    <div class="ibox-tools" style="margin-bottom:35px;position:relative;top:-30px">
                                        文章分类<select name="type_id">
                                        <option value="">请选择</option>
                                        <foreach name="clist" item="vo">
                                            <option value="{$vo.id}" <if condition="I('get.type_id','') eq $vo['id']">selected</if>>{$vo.tname}</option>
                                        </foreach>
                                    </select>
                                        <!--<input type="text" name="keyword" class="so_input"
										value="{:bian(I('get.keyword'))}"
										placeholder="输入关键字查询"/>-->
                                        <input type="submit" value="搜索"
                                               style="height:28px;
                                               margin-right:7px;font-size:13px;
                                               border:1px solid #eee;margin-left:-10px;"/>

                                    </div>
                                </form>
                            </div>
                            <div class="ibox-content">
                                <table class="table table-striped table-bordered table-hover " id="editable" >
                                    <thead>
                                        <tr>
                                            <th align:center>ID</th>
                                            <th>标题</th>
                                            <th>标题logo</th>
                                            <th>文章分类</th>
                                            <th>发布时间</th>
                                            <th>是否显示</th>
                                            <th>是否推荐</th>
                                            <th>排序数字</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <foreach name="dlist" item="vo" key="k">
                                            <tr class="gradeU" id="{$vo.id}">
                                                    <td class="jz">{$vo.id}</td>
                                                    <td class="jz" style="cursor:pointer;color:{$vo.colorval};font-weight:{$vo.boldval}">
                                                        {$vo.title}
                                                    </td>
                                                    <td class="jz"><if condition="$vo.logo"><img src="{$vo.logo}" width="60px" height="20px" /></if> </td>
                                                    <td class="jz">{$vo.tname}</td>
                                                    <td class="jz">{$vo.uptime|date='Y-m-d h:i:s',###}</td>
                                                    <td class="jz xs"  mid="{$vo.id}">
                                                        <if condition="$vo['is_show'] eq 1">
                                                            <img src="__PUBLIC__/Admin/img/true.png" xs="1" /><else/>
                                                            <img src="__PUBLIC__/Admin/img/error.png" xs="0" />
                                                        </if>
                                                    </td>
                                                    <td class="jz dh" mid="{$vo.id}">
                                                        <if condition="$vo['is_rec'] eq 1">
                                                            <img src="__PUBLIC__/Admin/img/true.png" xs="1" /><else/>
                                                            <img src="__PUBLIC__/Admin/img/error.png" xs="0" />
                                                        </if>
                                                    </td>
                                                    <td class="jz">
                                                        <span class="up" onclick="ajax_up(this)"  mid="{$vo.id}" val="{$vo.sort_num}"   style="font-size: 18px;font-weight: 700;cursor:pointer;" title="提升排序"><</span>
                                                        <span><input class="px" type="text" value="{$vo.sort_num}" size='2' style="text-align: center;" readonly/></span>
                                                        <span class="down" onclick="ajax_down(this)" mid="{$vo.id}"  val="{$vo.sort_num}" style="font-size: 18px;font-weight: 700;cursor:pointer;" alt="下降排序">></span>
                                                    </td>
                                                <script>
                                                    function ajax_up(a){
                                                        //alert($(a).parent().parent('.gradeU').index());return false;
                                                        var mid=$(a).attr('mid');
                                                        //alert(mid);
                                                        //return false;
                                                        var val=$(a).attr('val');
                                                        var tid="{:I('get.type_id')}";
                                                        //alert(val);
                                                        var wo=$(a).parent().parent('.gradeU');
                                                        $(".up").attr('onclick','');
                                                        //alert(wo.html());
                                                        var url="{:U('Article/ajax_up')}";
                                                        $.post(url,{mid:mid,val:val,tid:tid},function(e){
                                                            if(e.now){
                                                                if($(a).parent().parent('.gradeU').index()==0){
                                                                    location.reload();return false;
                                                                }else{
                                                                    //alert(wo.html());
                                                                    $(a).attr('val', e.now.sort_num);
                                                                    //$(a).attr('mid', e.now.id);
                                                                    $(a).parent().find('.down').attr('val', e.now.sort_num);
                                                                    $(a).parent().find(".px").val(e.now.sort_num);
                                                                    //$(a).prev('.down').attr('mid', e.now.id);
                                                                    //wo.prev('.gradeU')
                                                                    wo.prev('.gradeU').find('.up').attr('val',e.updata.sort_num);
                                                                    //wo.prev('.gradeU').find('.up').attr('mid', e.updata.id);
                                                                    wo.prev('.gradeU').find('.down').attr('val',e.updata.sort_num);
                                                                    wo.prev('.gradeU').find('.px').val(e.updata.sort_num);
                                                                    // wo.prev('.gradeU').find('.down').attr('mid', e.updata.id);
                                                                    wo.after(wo.prev('.gradeU'));
                                                                    $(".up").attr('onclick','ajax_up(this)');
                                                                }
                                                            }else{
                                                                alert('没有了');
                                                                $(".up").attr('onclick','ajax_up(this)');
                                                            }
                                                        },'json');
                                                    }
                                                    function ajax_down(a){
                                                        var mid=$(a).attr('mid');
                                                        var val=$(a).attr('val');
                                                        var tid="{:I('get.type_id')}";
                                                        //alert(val);
                                                        var wo=$(a).parent().parent('.gradeU');
                                                        //alert(wo.html());
                                                        var url="{:U('Article/ajax_down')}";
                                                        $(".down").attr('onclick','');
                                                        $.post(url,{mid:mid,val:val,tid:tid},function(e){
                                                            if(e.now){
                                                                if($(a).parent().parent('.gradeU').is('tr.gradeU:last')){
                                                                    location.reload();
                                                                    return false;
                                                                }else{
                                                                    //alert(wo.html());
                                                                    $(a).attr('val', e.now.sort_num);
                                                                    $(a).parent().find('.up').attr('val', e.now.sort_num);
                                                                    $(a).parent().find(".px").val(e.now.sort_num);
                                                                    wo.next('.gradeU').find('.up').attr('val',e.updata.sort_num);
                                                                    wo.next('.gradeU').find('.down').attr('val',e.updata.sort_num);
                                                                    wo.next('.gradeU').find('.px').val(e.updata.sort_num);
                                                                    wo.before(wo.next('.gradeU'));
                                                                    $(".down").attr('onclick','ajax_down(this)');
                                                                }
                                                            }else{
                                                                alert('没有了');
                                                                $(".down").attr('onclick','ajax_down(this)');
                                                            }
                                                        },'json');
                                                    }
                                                </script>
                                                    <td class="jz">
                                                        <a href="{:U('Article/lis',array('id'=>$vo['id']))}" >
                                                            编辑
                                                        </a>
                                                        <a  href="">
                                                            删除
                                                        </a>
														<a  href="{:U('Article/update',array('id'=>$vo['id'],'cid'=>I('get.cid')))}">
                                                            更新
                                                        </a>
                                                    </td>
                                            </tr>
                                        </foreach>

                                    </tbody>
                                    <script>
                                        $(function(){
                                            $(".xs").find('img').click(function() {
											    if(confirm('你确定要修改吗')){
												    var url = "{:U('Article/ajaxChange')}";
													var val = $(this).attr('xs');
													var mid = $(this).parent().attr('mid');
													if (val == 1) {
														$.post(url, {xs: val, mid: mid,type:1});
														$(this).attr('src', "__PUBLIC__/Admin/img/error.png");
														$(this).attr('xs', '0');

													} else {
														$.post(url, {xs: val, mid: mid,type:1});
														$(this).attr('src', "__PUBLIC__/Admin/img/true.png");
														$(this).attr('xs', '1');
													}												
												}else{
												    return false;
												}                                               
                                            })
                                            $(".dh").find('img').click(function() {
												if(confirm('你确定要修改吗')){
													var url = "{:U('Article/ajaxChange')}";
													var val = $(this).attr('xs');
													var mid = $(this).parent().attr('mid');
													//alert(mid);
													if (val == 1) {
														$.post(url, {xs: val, mid: mid,type:2});
														$(this).attr('src', "__PUBLIC__/Admin/img/error.png");
														$(this).attr('xs', '0');
													} else {
														$.post(url, {xs: val, mid: mid,type:2});
														$(this).attr('src', "__PUBLIC__/Admin/img/true.png");
														$(this).attr('xs', '1');
													}
												}else{
												    return false;
												}
                                            })
                                        })
                                    </script>

                                </table>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6">
                    <div class="dataTables_info" id="editable_info" role="alert" aria-live="polite" aria-relevant="all"></div>
                    </div>
                    <div class="col-sm-6">
                    {$plist}
                    </div>
                </div>
            </div>
<include file="Public/footer"/>