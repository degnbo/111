<include file="Public/header"/>
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>数据表格</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="index.html">栏目管理</a>
                        </li>
                        <li>
                            <strong>分类栏目</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">

                </div>
            </div>
<script src="__PUBLIC__/Admin/layer/layer.js"></script>
        <script>
            function fnClickAddRow() {
                layer.open({
                    type: 2,
                    title: '栏目管理',
                    shadeClose: true,
                    shade: 0.8,
                    area: ['680px', '90%'],
                    content: "{:U('Category/add')}", //iframe的url
                    end: function () {
                        location.reload();
                    }

                });
            }
        </script>

            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <span class="">
                                    <a onclick="fnClickAddRow();" href="javascript:void(0);" class="btn btn-primary ">添加栏目</a>
                                </span>

                                <form action="{:U('Category/lis')}" method="get">
                                    <div class="ibox-tools" style="margin-bottom:35px;position:relative;top:-30px">
                                        <input type="text" name="keyword" class="so_input" placeholder="输入关键字查询"/>
                                        <input type="submit" value="搜索"
                                               style="height:28px;
                                               margin-right:7px;font-size:13px;
                                               border:1px solid #eee;margin-left:-10px;"/>

                                    </div>
                                </form>
                            </div>
                            <div class="ibox-content">
                                <table class="table table-striped table-bordered table-hover " id="editable" >
                                    <thead>
                                        <tr>
                                            <th align:center>栏目ID</th>
                                            <th>栏目名称</th>
                                            <th>是否显示</th>
                                            <th>是否导航</th>
                                            <th>排序数字</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <foreach name="dlist" item="vo" key="k">
                                            <tr class="gradeU" id="{$vo.id}" clas="{$vo['level']}"
                                                style="<if condition='$vo.level gt 0'>display:none</if>">
                                                    <td class="jz">{$vo.id}</td>
                                                    <td class="" style="cursor:pointer;">
                                                        {$vo['level']*2|str_repeat="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",###}
                                                        <img class='add' src="__PUBLIC__/Admin/img/btn_jia.gif"/>{$vo.cate_name}
                                                    </td>
                                                    <td class="jz xs"  mid="{$vo.id}">
                                                        <if condition="$vo['is_show'] eq 1">
                                                            <img src="__PUBLIC__/Admin/img/yes.gif" xs="1" /><else/>
                                                            <img src="__PUBLIC__/Admin/img/no.gif" xs="0" />
                                                        </if>
                                                    </td>
                                                    <td class="jz dh" mid="{$vo.id}">
                                                        <if condition="$vo['is_nav'] eq 1">
                                                            <img src="__PUBLIC__/Admin/img/yes.gif" xs="1" /><else/>
                                                            <img src="__PUBLIC__/Admin/img/no.gif" xs="0" />
                                                        </if>
                                                    </td>
                                                    <td class="jz">
                                                        <span class="up" onclick="ajax_up(this)" pid="{$vo.pid}" mid="{$vo.id}" val="{$vo.sort_num}"   style="font-size: 18px;font-weight: 700;cursor:pointer;" title="提升排序"><</span>
                                                        <span><input class="px" type="text" value="{$vo.sort_num}" size='2' style="text-align: center;" readonly/></span>
                                                        <span class="down" onclick="ajax_down(this)" mid="{$vo.id}" pid="{$vo.pid}" val="{$vo.sort_num}" style="font-size: 18px;font-weight: 700;cursor:pointer;" alt="下降排序">></span>
                                                    </td>
                                                    <td class="jz"><a href="javascript:void(0)" onclick="laydiv(this,'{$vo.id}')">
                                                        <img src="__PUBLIC__/Admin/img/update.png" width="20px"/></a>
                                                        <a onclick="del(this,'{$vo.id}')" href="javascript:void(0)">
                                                            <img src="__PUBLIC__/Admin/img/del.png"/>
                                                        </a>
                                                    </td>
                                            </tr>
                                        </foreach>

                                    </tbody>
                                    <script>
                                        function del(obj,id){
                                            if(confirm('你确定要删除')){
                                                $(obj).parent().parent().remove();
                                                $.ajax({
                                                    url:"{:U('delete')}",
                                                    data:{id:id},
                                                    type:'get',
                                                })
                                            }else{
                                                return false;
                                            }
                                        }
                                    </script>

                                    <script>
                                        function ajax_up(a){
                                            //alert($(a).parent().parent('.gradeU').index());return false;
                                            var mid=$(a).attr('mid');
                                            //alert(mid);
                                            //return false;
                                            var pid=$(a).attr('pid');
                                            var val=$(a).attr('val');
                                            //alert(val);
                                            var wo=$(a).parent().parent('.gradeU');
                                            $(".up").attr('onclick','');
                                            //alert(wo.html());
                                            var url="{:U('Category/ajax_up')}";
                                            $.post(url,{mid:mid,val:val,pid:pid},function(e){
                                                //alert(e);
                                                if(e.now){
                                                    $(a).attr('val', e.now.sort_num);
                                                    $(a).parent().find('.down').attr('val', e.now.sort_num);
                                                    $(a).parent().find('.px').val(e.now.sort_num);
                                                    $("#"+e.updata.id).find('.down').attr('val',e.updata.sort_num);
                                                    $("#"+e.updata.id).find('.up').attr('val',e.updata.sort_num);
                                                    $("#"+e.updata.id).find('.px').val(e.updata.sort_num);
                                                    //alert($(a).parent().find('.px input').val());
                                                    $.each(e.updata.js,function(i,v){
                                                        //alert(v);
                                                        $("#"+e.now.js).after($("#"+v));
                                                    })
                                                    //wo.after(wo.prev('.gradeU'));
                                                    $(".up").attr('onclick','ajax_up(this)');
                                                }else{
                                                    alert('没有了');
                                                    $(".up").attr('onclick','ajax_up(this)');
                                                }
                                            },'json');
                                        }
                                        function ajax_down(a){
                                            var mid=$(a).attr('mid');
                                            var val=$(a).attr('val');
                                            var pid=$(a).attr('pid');
                                            //alert(val);
                                            var wo=$(a).parent().parent('.gradeU');
                                            //alert(wo.html());
                                            var url="{:U('Category/ajax_down')}";
                                            $(".down").attr('onclick','');
                                            $.post(url,{mid:mid,val:val,pid:pid},function(e){
                                                if(e.now){
                                                    $(a).attr('val', e.now.sort_num);
                                                    $(a).parent().find('.up').attr('val', e.now.sort_num);
                                                    $(a).parent().find(".px").val(e.now.sort_num);
                                                    $("#"+e.updata.id).find('.down').attr('val',e.updata.sort_num);
                                                    $("#"+e.updata.id).find('.up').attr('val',e.updata.sort_num);
                                                    $("#"+e.updata.id).find('.px').val(e.updata.sort_num);
                                                    $.each(e.now.js,function(i,v){
                                                        //alert(v);
                                                        $("#"+e.updata.js).after($("#"+v));
                                                    })
                                                    $(".down").attr('onclick','ajax_down(this)');
                                                }else{
                                                    alert('没有了');
                                                    $(".down").attr('onclick','ajax_down(this)');
                                                }
                                            },'json');
                                        }
                                    </script>
                                    <script>
                                        $(function(){
                                            $(".xs").find('img').click(function() {
                                                if(confirm("你确定修改吗?")){
                                                    var url = "{:U('Category/ajaxChange')}";
                                                    var val = $(this).attr('xs');
                                                    var mid = $(this).parent().attr('mid');
                                                    if (val == 1) {
                                                        $.post(url, {xs: val, mid: mid,type:1});
                                                        $(this).attr('src', "__PUBLIC__/Admin/img/no.gif");
                                                        $(this).attr('xs', '0');

                                                    } else {
                                                        $.post(url, {xs: val, mid: mid,type:1});
                                                        $(this).attr('src', "__PUBLIC__/Admin/img/yes.gif");
                                                        $(this).attr('xs', '1');
                                                    }
                                                }else{
                                                    return false;
                                                }
                                            })
                                            $(".dh").find('img').click(function() {
                                                if(confirm("你确定修改吗?")){
                                                    var url = "{:U('Category/ajaxChange')}";
                                                    var val = $(this).attr('xs');
                                                    var mid = $(this).parent().attr('mid');
                                                    //alert(mid);
                                                    if (val == 1) {
                                                        $.post(url, {xs: val, mid: mid,type:2});
                                                        $(this).attr('src', "__PUBLIC__/Admin/img/no.gif");
                                                        $(this).attr('xs', '0');
                                                    } else {
                                                        $.post(url, {xs: val, mid: mid,type:2});
                                                        $(this).attr('src', "__PUBLIC__/Admin/img/yes.gif");
                                                        $(this).attr('xs', '1');
                                                    }
                                                }else{
                                                    return false;
                                                }
                                            })
                                        })
                                        $(function(){
                                            $('.add').click(function(){
                                                var img=$(this);
                                                //alert(img.parent().parent().attr('class'));
                                                //return false;
                                                if( img.attr('src')=="__PUBLIC__/Admin/img/btn_jia.gif"){
                                                    img.attr('src',"__PUBLIC__/Admin/img/btn_jian.gif");
                                                    img.parent().parent().nextAll().each(function(i,val){
                                                        //alert($(val).attr('class'));
                                                        if($(val).attr('clas')==parseInt(img.parent().parent().attr('clas'))+1){
                                                            $(val).show();
                                                        }
                                                        if($(val).attr('clas')<=parseInt(img.parent().parent().attr('clas'))){
                                                            return false;
                                                        }
                                                    })
                                                }else{
                                                    $(this).attr('src',"__PUBLIC__/Admin/img/btn_jia.gif");
                                                    img.parent().parent().nextAll().each(function(i,val){
                                                        //alert($(val).attr('class'));
                                                        if($(val).attr('clas')>parseInt(img.parent().parent().attr('clas'))){
                                                            $(val).hide();
                                                            $(val).children('td').find('img.add').attr('src',"__PUBLIC__/Admin/img/btn_jia.gif");
                                                        }else{
                                                            return false;
                                                        }
                                                    })
                                                }
                                            })
                                        })

                                    </script>

                                </table>

                            </div>
                        </div>
                    </div>
                </div>
                <!--<div class="row">
                    <div class="col-sm-6">
                    <div class="dataTables_info" id="editable_info" role="alert" aria-live="polite" aria-relevant="all">显示 1 到 10 项，共 39 项</div>
                    </div>
                    <div class="col-sm-6">
                    <div class="dataTables_paginate paging_simple_numbers" id="editable_paginate">
                        <ul class="pagination"><li class="paginate_button previous disabled" aria-controls="editable" tabindex="0" id="editable_previous">
                            <a href="#">上一页</a></li><li class="paginate_button active" aria-controls="editable" tabindex="0"><a href="#">1</a></li>
                            <li class="paginate_button " aria-controls="editable" tabindex="0"><a href="#">2</a></li>
                            <li class="paginate_button " aria-controls="editable" tabindex="0"><a href="#">3</a></li>
                            <li class="paginate_button " aria-controls="editable" tabindex="0"><a href="#">4</a></li>
                            <li class="paginate_button next" aria-controls="editable" tabindex="0" id="editable_next"><a href="#">下一页</a></li>
                        </ul>
                    </div>
                    </div>
                </div>-->
            </div>
<include file="Public/footer"/>
<script src="__PUBLIC__/Admin/layer/layer.js"></script>
<script>
    /*{:U('Category/edit',array('id'=>$vo['id']))}*/
    function laydiv(obj,id){
        layer.open({
            type: 2,
            title: '栏目管理',
            shadeClose: true,
            shade: 0.8,
            area: ['680px', '90%'],
            content: '/index.php/Admin/Category/edit?id='+id, //iframe的url
        });
    }
</script>